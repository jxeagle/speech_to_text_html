<html>
  <head>
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap@4.5.2/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc2/css/bootstrap-glyphicons.css"/>
    <link type="text/css" rel="stylesheet" href="//unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css"/>
    <link rel="stylesheet" href="cards.css">
  </head>
  <body>
    <div id="app">
      <h1 class="title">记住后说 "开始"; "再来一次" 做下一道题;
        <span class="final" id="current_result"></span>
        <span class="final" id="final_span"></span>
        <span class="interim" id="interim_span"></span>
      </h1>

      <div class="cards">
        <section :class="'card card--' + card.suit" :value=card.display v-for="card in cards">
          <div class="card__inner card__inner--centered">
            <div class="card__column">
              <div class="card__symbol"></div>
              <div class="card__symbol"></div>
            </div>
          </div>
        </section>
      </div>
    </div>
    <script src="//unpkg.com/jquery@3.1.1/dist/jquery.slim.min.js"></script>
    <script src="//unpkg.com/tether@1.4.0/dist/js/tether.min.js"></script>
    <script src="//unpkg.com/bootstrap@4.0.0-alpha.6/dist/js/bootstrap.min.js"></script>
    <script src="//unpkg.com/moment@2.22.2/moment.js"></script>
    <script src="//unpkg.com/axios/dist/axios.min.js"></script>
    <script src="//unpkg.com/vue@2.2.5/dist/vue.js" type="text/javascript"></script>
    <script src="//unpkg.com/babel-polyfill@6.26.0/dist/polyfill.min.js"></script>
    <script src="//unpkg.com/bootstrap-vue@2.0.0-rc.20/dist/bootstrap-vue.js"></script>
    <script src="//unpkg.com/@tensorflow/tfjs@3.0.0/dist/tf.min.js"></script>
    <script src="//unpkg.com/@tensorflow-models/speech-commands@0.5.4/dist/speech-commands.min.js"></script>

    <script>
      const deck = [];
      // from 1-13 and club,diamond,heart,spade, create a deck of cards
      for (let i = 1; i <= 13; i++) {
        let display = i;
        if (display === 1) display = 'A';
        if (display === 11) display = 'J';
        if (display === 12) display = 'Q';
        if (display === 13) display = 'K';
        deck.push({ value: i, display: display, suit: 'club', });
        deck.push({ value: i, display: display, suit: 'diamond' });
        deck.push({ value: i, display: display, suit: 'heart' });
        deck.push({ value: i, display: display, suit: 'spade' });
      }
      var esg_nlp = new Vue({
        el: '#app',
        data: {
          recognizer: null,
          cards: [1],
        },
        methods: {
          pick_cards: (app) => {
            // pick 5 distinct cards from the deck
            const shuffled = deck.sort(() => 0.5 - Math.random());
            app.cards = shuffled.slice(0, 5);
            console.log(app.cards)
          },
          init_recognizer: async () => {
            const recognizer = await speechCommands.create(
              'BROWSER_FFT', undefined,
              'http://localhost:5500/model/play-cards.json',
              'http://localhost:5500/model/play-cards.metadata.json');
            await recognizer.ensureModelLoaded();

            recognizer.listen(result => {
              // log the word with the highest score
              const scores = result.scores;
              const maxScoreIndex = scores.indexOf(Math.max(...scores));
              const word = recognizer.wordLabels()[maxScoreIndex];
              const score = scores[maxScoreIndex];

              // log top 3 words with their scores
              const top3 = Array.from(scores)
                .map((s, i) => ({ score: s, word: recognizer.wordLabels()[i] }))
                .sort((s1, s2) => s2.score - s1.score)
              console.log(word, score);
            }, {
              includeSpectrogram: true,
              probabilityThreshold: 0.93,
              overlapFactor: 0.7
            });
            return recognizer;
          },
        },
        mounted() {
          this.init_recognizer();
          this.pick_cards(this);
          console.log('mounted');
        }
      });
    </script>
  </body>
</html>