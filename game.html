<html>
  <head>
    <link rel="stylesheet" href="cards.css">
    <style>
      #info { font-size: 20px; }
      #div_start { float: right; }
      #headline { text-decoration: none }
      #results { font-size: 14px; font-weight: bold; border: 1px solid #ddd; padding: 15px; text-align: left; min-height: 150px; }
      #start_button { border: 0; background-color:transparent; padding: 0; }
      .interim { color: gray; }
      .final { color: black; padding-right: 3px; }
      .button { display: none; }
      .marquee { margin: 20px auto; }
      #buttons { margin: 10px 0; position: relative; top: -50px; }
      #copy { margin-top: 20px; }
      #copy > div { display: none; margin: 0 70px; }
      a.c1 {font-weight: normal;}
      </style>
  </head>
  <body>

    <div id="results">
      <span class="final" id="final_span"></span>
      <span class="interim" id="interim_span"></span>
    </div>

    <h1 class="title">Flexbox layout for ♥ and ♠</h1>

    <section class="cards">
    </section>

    <script>
      let ranks = [
        ["A", "一", "s", ],
        ["2", "二"],
        ["3", "三"],
        ["4", "四", "似"],
        ["5", "五"],
        ["6", "六"],
        ["7", "七", "漆"],
        ["8", "八", "吧"],
        ["9", "九", "酒"],
        ["10", "十"],
        ["J", "Jack", "坑", "乔", "给"],
        ["Q", "P", "Queen", "皮蛋"],
        ["K", "k", "king", "老"],
      ];
      let suits = [
        ["spade", "梅", "梅花", "草花"],
        ["diamond", "方", "方块"],
        ["heart", "红", "红桃", "红心"],
        ["club", "黑", "黑桃"],
      ];
    </script>

    <script>
      // get a pair of random numbers between 1 and length of rnaks and suits
      function getRandomPair() {
        let rank = Math.floor(Math.random() * ranks.length);
        let suit = Math.floor(Math.random() * suits.length);
        return [[rank,ranks[rank]], [suit, suits[suit]]];
      }

      // get 5 pairs of random numbers
      function getRandomPairs() {
        let pairs = [];
        for (let i = 0; i < 5; i++) {
          pairs.push(getRandomPair());
        }
        return pairs;
      }

      function dealCards() {
        pairs = getRandomPairs();
        console.log(pairs);
        // remove all elements under cards
        document.querySelector(".cards").innerHTML = "";
        // add new elements
        for (let i = 0; i < 5; i++) {
          let rank = pairs[i][0][1][0];
          let suit = pairs[i][1][1][0];
          let card = document.createElement("section");
          card.className = "card card--" + suit;
          card.setAttribute("value", rank);
          card.innerHTML = `
            <div class="card__inner card__inner--centered">
              <div class="card__column">
                <div class="card__symbol"></div>
                <div class="card__symbol"></div>
              </div>
            </div>
          `;
          document.querySelector(".cards").appendChild(card);
        }
      };

      dealCards()
    </script>

    <script>
      var final_transcript = '';
      var recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'cmn-Hans-CN';

      function process_command(command) {
        console.log('command received: ' + command);
        // if command ends with '开始'
        if (command.endsWith('开始')) {
          console.log('开始');
          let cards = document.querySelectorAll(".card");
          for (let i = 0; i < cards.length; i++) {
            hideCard(i);
          }
          return
        }
        else if (command.endsWith('再来一次')) {
          dealCards();
          return
        }
        else {

        }
      }

      function hideCard(i) {
        let cards = document.querySelectorAll(".card");
        cards[i].classList.add("card--flipped");
      }

      recognition.onstart = function() {
        console.log("speech recognition started");
      };

      recognition.onresult = function(event) {
        console.log(event);
        var interim_transcript = '';
        for (var i = event.resultIndex; i < event.results.length; ++i) {
          command = event.results[i][0].transcript
          if (event.results[i].isFinal) {
            final_transcript += command;
            process_command(command)
          } else {
            process_command(command)
            interim_transcript += command;
          }
        }
        final_span.innerHTML = final_transcript;
        interim_span.innerHTML = interim_transcript;
      };

      recognition.onend = function() {
        console.log("speech recognition has ended after ending after 60 mins")
        recognition.start()
      };

      recognition.onerror = function(event) {
        console.log("speech recognition error")
        console.log(event);
      };

      recognition.start()



    </script>
  </body>
</html>